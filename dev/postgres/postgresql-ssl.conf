# PostgreSQL SSL Configuration
# This file is mounted into PostgreSQL container

# SSL Configuration
ssl = on
ssl_cert_file = '/etc/ssl/certs/postgres-cert.pem'
ssl_key_file = '/etc/ssl/private/postgres-key.pem'
ssl_ca_file = '/etc/ssl/certs/ca-cert.pem'

# Require SSL for all connections
ssl_prefer_server_ciphers = on
ssl_ciphers = 'ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256'
ssl_protocols = 'TLSv1.2,TLSv1.3'

# Client certificate authentication
password_encryption = scram-sha-256

# Host-based authentication with SSL
hostssl all all 0.0.0.0/0 cert

# Log SSL connections
log_connections = on
log_disconnections = on
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '

# SSL renegotiation
ssl_renegotiation_limit = 512MB
